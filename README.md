# СКС ДЗ 4

## Что мы делаем
Мы делаем фильтрацию http, потому что http просто проверить.
Можно поднять сервер `python -m http.setver`. Он будет слушать на 
Затем проверять с помощью `curl`.

Весь код теперь в одном файле, потому что мне налоело копировать файлы в GNS туда сюда.

Я ленивый.
Обрабатываться будет только стек IP4 -> TCP -> HTTP. Никаких там IPV6 или чего-нибудь ещё.
Также пока что обрабатывается http.
Фильтрации по ip или чему-то из TCP нет.
А еще это глупенько, поскольку у нас сначала пройдет handshake, а потом не будут проходить пакеты, ну да ладно.

Сборка и запуск:
`g++ -std=c++20 firewall.cpp -lnetfilter_queue`. Единственным аргументом командной строки можно опционально указать номер очереди. По умолчанию `0`.

## Правила
- Правила читаются из `rules.txt`, который должен быть в той же директории.
- Правила записываются по одному на строку.
- Правила нечуствительны к регистру и лишним пробелам (кроме, мб ключей или значений). Т. е. можно писать `aCcEpT`.
- Для пакета проверяются все правила попорядку и срабатывает последнее, на котором произошло совпадение.

Правило начинается с действия `ACCEPT` или `DROP`.
Затем идет остальная часть.

1. `DEFAULT` подходит подо все. Должно быть хотя бы одно такое правило, иначе UB.
2. `REQUEST` и `RESPONSE`. Подходят под запросы и ответы соответственно.
3. `REQUEST_METHOD <METHOD>`. Подходят под запрос определенного типа
4. `RESPONSE_CODE <CODE>`. Только ответы с определенным кодом.

### Пример

```
ACCEPT DEFAULT
DROP REQUEST
ACCEPT REQUEST_METHOD GET
DROP RESPONSE_CODE 404
```

Разрешаем get запросы и не 404 ответ.

p.s Я задолбался это все реализовывать.
